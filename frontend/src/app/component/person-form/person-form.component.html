<div class="container">
  <h2>Person Analysis</h2>

  <form #f="ngForm" (ngSubmit)="onSubmit()" novalidate>
    <div class="form-group">
      <label for="firstName">First Name</label>
      <input
        id="firstName"
        type="text"
        name="firstName"
        [(ngModel)]="person.firstName"
        #firstName="ngModel"
        required
        [class.invalid]="firstName.invalid && firstName.touched"
        [attr.aria-invalid]="firstName.invalid ? 'true' : 'false'"
      />
      @if (firstName.invalid && firstName.touched) {
      <div class="hint error">First name is required.</div>
      }
    </div>

    <div class="form-group">
      <label for="lastName">Last Name</label>
      <input
        id="lastName"
        type="text"
        name="lastName"
        [(ngModel)]="person.lastName"
        #lastName="ngModel"
        required
        [class.invalid]="lastName.invalid && lastName.touched"
        [attr.aria-invalid]="lastName.invalid ? 'true' : 'false'"
      />
      @if (lastName.invalid && lastName.touched) {
      <div class="hint error">Last name is required.</div>
      }
    </div>

    <div class="form-group">
      <label>Social Skills</label>

      @for (skill of person.socialSkills; track $index; let i = $index) {
      <div class="row">
        <input
          type="text"
          [(ngModel)]="person.socialSkills[i]"
          [name]="'skill' + i"
          placeholder="Add a skill"
        />
        <button
          type="button"
          class="btn btn-danger"
          (click)="removeSocialSkill(i)"
        >
          Remove
        </button>
      </div>
      } @empty {
      <p class="muted">No social skills added.</p>
      }

      <button
        type="button"
        class="btn btn-secondary"
        (click)="addSocialSkill()"
      >
        Add Social Skill
      </button>
    </div>

    <div class="form-group">
      <label>Social Accounts</label>

      @for (account of person.socialAccounts; track $index; let i = $index) {
      <div class="grid two">
        <input
          type="text"
          [(ngModel)]="account.type"
          [name]="'accountType' + i"
          placeholder="Type (e.g., Twitter)"
        />
        <div class="end">
          <input
            type="text"
            [(ngModel)]="account.address"
            [name]="'accountAddress' + i"
            placeholder="Address"
          />
          <button
            type="button"
            class="btn btn-danger"
            (click)="removeSocialAccount(i)"
          >
            Remove
          </button>
        </div>
      </div>
      } @empty {
      <p class="muted">No social accounts added.</p>
      }

      <button
        type="button"
        class="btn btn-secondary"
        (click)="addSocialAccount()"
      >
        Add Social Account
      </button>
    </div>

    <div class="actions">
      <button type="submit" class="btn btn-primary" [disabled]="f.invalid">
        Analyze
      </button>
    </div>
  </form>

  @if (errorMessage) {
  <div class="error" role="alert" aria-live="polite">
    {{ errorMessage }}
  </div>
  } @if (analysis) {
  <section class="results card">
    <h3>Analysis Results</h3>
    <div class="kpi-grid">
      <div class="kpi">
        <span class="kpi-label">Vowels</span
        ><span class="kpi-value">{{ analysis.vowelsCount }}</span>
      </div>
      <div class="kpi">
        <span class="kpi-label">Consonants</span
        ><span class="kpi-value">{{ analysis.consonantsCount }}</span>
      </div>
    </div>
    <p><strong>Full name:</strong> {{ analysis.fullName }}</p>
    <p><strong>Reversed full name:</strong> {{ analysis.reversedFullName }}</p>

    <h4>Input JSON</h4>
    <pre class="code-block">{{ analysis.jsonFormat }}</pre>
  </section>
  }
</div>
